generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User Model
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  firstName String
  lastName  String
  role      Role     @default(EMPLOYEE)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  reservations Reservation[]
  accessLogs   AccessLog[]

  @@map("users")
}

enum Role {
  EMPLOYEE
  MANAGER
  ADMIN
}

// Space Model
model Space {
  id        String    @id @default(uuid())
  name      String
  type      SpaceType
  capacity  Int
  floor     String?
  building  String?
  openTime  String
  closeTime String
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  reservations Reservation[]

  @@map("spaces")
}

enum SpaceType {
  DESK
  MEETING_ROOM
  COLLABORATIVE_SPACE
}

// Reservation Model
model Reservation {
  id          String        @id @default(uuid())
  userId      String
  spaceId     String
  startTime   DateTime
  endTime     DateTime
  status      BookingStatus @default(ACTIVE)
  qrCode      String?       @unique
  qrSignature String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  user       User        @relation(fields: [userId], references: [id])
  space      Space       @relation(fields: [spaceId], references: [id])
  accessLogs AccessLog[]

  @@index([spaceId, startTime, endTime])
  @@index([userId])
  @@map("reservations")
}

enum BookingStatus {
  ACTIVE
  CANCELLED
  COMPLETED
}

// Access Log Model
model AccessLog {
  id            String   @id @default(uuid())
  reservationId String
  userId        String
  accessTime    DateTime @default(now())
  accessGranted Boolean
  method        String

  reservation Reservation @relation(fields: [reservationId], references: [id])
  user        User        @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([accessTime])
  @@map("access_logs")
}